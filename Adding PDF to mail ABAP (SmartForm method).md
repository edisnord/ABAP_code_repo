# Adding PDF to mail ABAP (SmartForm method)

You need to create a SmartForm with the contents of the PDF. After creation you use:

```ABAP
CALL FUNCTION 'SSF_FUNCTION_MODULE_NAME'
      EXPORTING
*       FORMNAME                 = 'Name of the form'
*       VARIANT                  = ' '
*       DIRECT_CALL              = ' '
     IMPORTING
       FM_NAME                  =  'Name of the FM the form generates'
     EXCEPTIONS
       NO_FORM                  = 1
       NO_FUNCTION_MODULE       = 2
       OTHERS                   = 3
```

This function module gets the name of the function module which is generated by the SmartForm, and saves it in a variable. Then for the next step you call the function with the name you got from the FM above

For this next step you need to have 2 work areas declared with these types.

```ABAP
DATA: lw_control_parameters type ssfctrlop,
      lw_output_options     type ssfcompop.
```

You then set these settings in the work areas, the point of these settings is to stop the device dialog of SmartForms from appearing when you're trying to get the form data:

```abap
    lw_control_parameters-getotf        = 'X'.
    lw_control_parameters-no_dialog  = 'X'.
    LW_CONTROL_PARAMETERS-PREVIEW = 'X'.
    LW_CONTROL_PARAMETERS-DEVICE = 'PRINTER'.
    lw_control_parameters-langu        = sy-langu.
    lw_output_options-tdnoprev          = 'X'.
    LW_OUTPUT_OPTIONS-TDPRINTER = 'LOCL'.
    lw_output_options-tddest = 'LOCL'.
```

We then call the function:

```ABAP
call function lv_sfnam
      exporting
         control_parameters = lw_control_parameters
         output_options       = lw_output_options
         user_settings         = '' "   The point of this is to tell the FM to actually consider our 												parameters inserted above, if left to 'X' it will ignore them
     importing
         job_output_info    = it_sfoutput "Type ssfcrescl
      exceptions
         formatting_error   = 1
         internal_error       = 2
         send_error           = 3
         user_canceled     = 4
         others                 = 5.
```

The output we want is in the otfdata column of the 'it_sfoutput' variable. We store this data into a table of type itcoo.

```ABAP
  refresh li_otf[].
  li_otf[] = lw_ssfcrescl-otfdata[].
```

Using this table as a parameter, we then call the FM 'CONVERT_OTF'

```ABAP
call function 'CONVERT_OTF'
      exporting
        format                =   'PDF'
      importing
        bin_filesize          =    lv_bin_filesize  "Type i
        bin_file			  =    lv_xpdf			"Type xstring, where our PDF data will be outputted
      tables
       otf                    =    li_otf			"Table we got from it_sfoutput-otfdata
        lines                 =    li_pdf_tab
      exceptions
        err_max_linewidth     =     1
        err_format            =     2
        err_conv_not_possible =	    3
        err_bad_otf           =     4
        others                =     5.
```

We then convert the output from xstring to solix using the method xstring_to_solix().

```ABAP
@DATA(lv_attachment) = xstring_to_solix( ip_xstring = lv_xpdf ).
```

Then if we want to attach this file to our mail(I assume everything else for the mail has been set up), we call the add_attachment() method like this:

```ABAP
document->add_attachment( i_attachment_type = 'PDF'
i_attachment_subject = 'fileame.pdf'
i_att_content_hex = lv_attachment).
```

